@model IEnumerable<LoanApplicationService.Service.DTOs.RepaymentSchedule.RepaymentScheduleDto>

@{
    ViewData["Title"] = "Schedule for Account";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>@ViewData["Title"]</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        body {
            background-color: #f4f6f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .schedule-header {
            text-align: center;
            margin-bottom: 2rem;
            color: #1a3c6d;
        }

        .account-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .summary-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .table-container {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .table {
            margin-bottom: 0;
        }

            .table th {
                font-size: 0.9rem;
                font-weight: 600;
                color: #5a6a85;
                background-color: #e9ecef;
            }

            .table td {
                font-size: 1rem;
                color: #1a3c6d;
                vertical-align: middle;
            }

            .table tr.paid {
                background-color: #e6f4ea;
            }

            .table tr.partial {
                background-color: #fff3cd;
            }

            .table tr.unpaid {
                background-color: #f8d7da;
            }

            .table tr:hover {
                background-color: #f1f3f5;
                transition: background-color 0.2s;
            }

        .currency::before {
            content: "Kshs ";
            font-size: 0.9rem;
        }

        .payment-progress {
            font-size: 0.85rem;
            color: #28a745;
        }

        .payment-pending {
            font-size: 0.85rem;
            color: #dc3545;
        }

        .container {
            max-width: 1400px;
            padding: 2rem;
        }
        @@media (max-width: 768px) {
            .table-container, .account-card, .summary-card

        {
            margin-bottom: 1rem;
        }

        .table th, .table td {
            font-size: 0.8rem;
        }

        .payment-progress, .payment-pending {
            font-size: 0.75rem;
        }

        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="schedule-header">Loan Repayment Schedule</h2>

        <!-- Account Details Card -->
        <div class="account-card">
            <h4>Account Details</h4>
            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <strong>Account ID:</strong> @(ViewBag.AccountId ?? "N/A")
                </div>
                <div class="col-md-3 col-sm-6">
                    <strong>Disbursement Date:</strong> @(ViewBag.DisbursementDate?.ToString("yyyy-MM-dd") ?? "N/A")
                </div>
                <div class="col-md-3 col-sm-6">
                    <strong>Original Principal:</strong> <span class="currency">@(ViewBag.OriginalPrincipal?.ToString("N2") ?? "0.00")</span>
                </div>
                <div class="col-md-3 col-sm-6">
                    <strong>Outstanding Balance:</strong> <span class="currency">@(ViewBag.OutstandingBalance?.ToString("N2") ?? "0.00")</span>
                </div>
            </div>
        </div>

        <!-- Summary Card -->
        @{
            var totalPrincipal = Model.Sum(i => i.PrincipalAmount);
            var totalInterest = Model.Sum(i => i.InterestAmount);
            var totalScheduled = Model.Sum(i => i.ScheduledAmount);
            var totalPaidPrincipal = Model.Sum(i => i.PaidPrincipal);
            var totalPaidInterest = Model.Sum(i => i.PaidInterest);
        }
        <div class="summary-card">
            <h4>Schedule Summary</h4>
            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <strong>Total Principal:</strong> <span class="currency">@totalPrincipal.ToString("N2")</span>
                </div>
                <div class="col-md-3 col-sm-6">
                    <strong>Total Interest:</strong> <span class="currency">@totalInterest.ToString("N2")</span>
                </div>
                <div class="col-md-3 col-sm-6">
                    <strong>Total Scheduled:</strong> <span class="currency">@totalScheduled.ToString("N2")</span>
                </div>
                <div class="col-md-3 col-sm-6">
                    <strong>Total Paid:</strong> <span class="currency">@((totalPaidPrincipal + totalPaidInterest).ToString("N2"))</span>
                </div>
            </div>
        </div>

        <!-- Repayment Schedule Table -->
        <div class="table-container">
            <h3>Repayment Schedule</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Installment</th>
                        <th>Due Date</th>
                        <th>Principal</th>
                        <th>Paid Principal</th>
                        <th>Interest</th>
                        <th>Paid Interest</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var installment in Model)
                    {
                        var isFullyPaid = installment.IsPaid;
                        var isPartialPaid = !installment.IsPaid && (installment.PaidPrincipal > 0 || installment.PaidInterest > 0);
                        var rowClass = isFullyPaid ? "paid" : (isPartialPaid ? "partial" : "unpaid");
                        <tr class="@rowClass">
                            <td>@installment.InstallmentNumber</td>
                            <td>@installment.DueDate.ToString("yyyy-MM-dd")</td>
                            <td><span class="currency">@installment.PrincipalAmount.ToString("N2")</span></td>
                            <td>
                                <span class="currency">@installment.PaidPrincipal.ToString("N2")</span>
                                @if (installment.PaidPrincipal > 0 && installment.PaidPrincipal < installment.PrincipalAmount)
                                {
                                    <span class="payment-progress"> (Partial)</span>
                                }
                            </td>
                            <td><span class="currency">@installment.InterestAmount.ToString("N2")</span></td>
                            <td>
                                <span class="currency">@installment.PaidInterest.ToString("N2")</span>
                                @if (installment.PaidInterest > 0 && installment.PaidInterest < installment.InterestAmount)
                                {
                                    <span class="payment-progress"> (Partial)</span>
                                }
                            </td>
                            <td><span class="currency">@installment.ScheduledAmount.ToString("N2")</span></td>
                            <td>
                                @if (isFullyPaid)
                                {
                                    <span class="payment-progress">Paid</span>
                                }
                                else if (isPartialPaid)
                                {
                                    <span class="payment-pending">Partially Paid</span>
                                }
                                else
                                {
                                    <span class="payment-pending">Unpaid</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>